# 简介

**什么是MyBatis？**

MyBatis是一款优秀的持久层框架。它支持制定化SQL，存储过程以及高级映射。

简而言之嘛，就是用来从数据库中存取数据。

**为什么要用MyBatis？**

我们知道MyBatis是个框架，框架存在的意义其实就是为了减轻我们的负担，用更少的代码做更多的事情。

在传统的Web开发中，我们是怎么实现数据的存取的呢？

一般，使用JDBC API实现从数据库中存取数据。

这么做有什么问题呢？代码冗余,重用性也不高，不好维护。

那么MyBatis又是怎么做的呢？

你只需要编写一个配置文件和映射文件就可以了。

简单来说，映射文件就是一个写Sql语句的地方。

配置文件顾名思义就是对MyBatis进行配置。

让我们通过一个例子来体验一下~

**MyBatis的工作流程**

# 例子

该例子通过maven来构建项目

使用工具：

- jdk 1.8
- mysql-connector-java 5.1.15
- mybatis 

## 引入依赖

```xml
    <dependency>
      <groupId>org.mybatis</groupId>
      <artifactId>mybatis</artifactId>
      <version>RELEASE</version>
    </dependency>

    <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>5.1.15</version>
    </dependency>
```

## 前期工作

### 创建User Bean

```java
public class User {
    private int id;
    private String userName;
    private String password;
    // getter setter
}
```

### 创建UserRepository接口

```java
public interface UserRepository {
    public int insert(User user);
    public int update(User user);
    public int deleteById(int id);
    public User selectById(int id);
}
```

### 创建数据库与表

```sql
create database mybatis_demo default character set = utf8;

create table tb_user(
   id int(11) NOT NULL AUTO_INCREMENT,
   username varchar(40) default null,
   password varchar(50) default null,
   primary key (id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```



## MyBatis的配置与映射

**这里先看看就好了，后面我们会详细讲解**

### 生成SqlSession的工具类

SqlSession对象是用来执行sql语句以及获取结果的，它由SqlSessionFactory生成。

```java
public class SqlSessionProvider {
    static SqlSessionFactory factory;
    static {
        Reader reader = null;
        // 查找配置文件，SqlSessionFactory对象的创建需要用到配置文件中的信息
        String resource = "MyBatis-Config.xml";
        try {
            reader = Resources.getResourceAsReader(resource);
        } catch (IOException e) {
            e.printStackTrace();
        }
        factory = new SqlSessionFactoryBuilder().build(reader);
    }
    public static SqlSession getSqlSession(){
        return factory.openSession();
    }
}
```

### MyBatis-Config.xml

正如前面所说，我们需要两个文件，一个是配置文件，一个是映射文件，这个就是我们的配置文件。

```xml
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>
    
    <typeAliases>
        <typeAlias alias="User" type="com.hdr.mybatisDemo.domain.User"/>
    </typeAliases>

    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://127.0.0.1:3306/mybatis_demo?characterEncoding=utf8"/>
                <property name="username" value="root"/>
                <property name="password" value="admin"/>
            </dataSource>
        </environment>
    </environments>

    <mappers>
        <mapper resource="mappers/UserRepository.xml"/>
    </mappers>

</configuration>
```

### UserRepository.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hdr.mybatisDemo.domain.repository.UserRepository">
    <insert id="insert" parameterType="User" useGeneratedKeys="true" keyProperty="id">
        insert into tb_user(username,password) values (#{userName},#{password})
    </insert>

    <select id="selectById" parameterType="int" resultType="User">
        select * from tb_user where id = #{id};
    </select>

    <update id="update" parameterType="User">
        update tb_user set username=#{username}, password=#{password} where id= #{id};
    </update>

    <delete id="deleteById" parameterType="int">
        delete * from tb_user where id=#{id};
    </delete>

    <select id="selectAll" resultType="User">
        select * from tb_user order by id asc ;
    </select>

</mapper>
```

## 初试MyBatis

```java
public class Demo {
    public static void main(String[] args) {
        User user = new User();
        user.setUserName("hdr");
        user.setPassword("admin");

        try(SqlSession sqlSession = SqlSessionProvider.getSqlSession()){
            UserRepository userRepository = sqlSession.getMapper(UserRepository.class);
            // 插入用户
            userRepository.insert(user);
            System.out.println(userRepository.selectById(user.getId()));
            //更新用户信息
            user.setUserName("hyc");
            userRepository.update(user);
            System.out.println(userRepository.selectById(user.getId()));
            //删除用户
            userRepository.deleteById(user.getId());
            System.out.println(userRepository.selectById(user.getId()));
            //提交事务
            sqlSession.commit();
        }
    }
}
```


