---
title : 深入理解SpringCloud 
categories : 
- 微服务
date : 2019-2-2
---

# 微服务简介

微服务指的就是把实现业务需求的应用拆分成一系列服务。它是SOA（面向服务架构）的一种变种。基于微服务架构的应用的最大好处就是它可以实现对一个大型的复杂的项目进行持续交付。

假设现在我们有一个客户，他想让我们设计一个类似银行的软件系统。我们决定设计一个基于关系型数据库的单机应用。

![1550819196127](/home/hdr/Desktop/Pictures/微服务/SpringCloud/银行系统单机应用.png)

## API网关

如上图，我们有四个实体，分别是产品、账号、客户、交易。

现在客户不想要更新的时候需要对整个应用重新部署。他想要一个易于扩展，可以方便的添加新模块、新功能的架构。

现在我们决定把单机应用拆分成四个独立的微服务，每个服务具有自己专用的数据库。随着微服务的增加，对于外部使用者来说，调用服务变得越来越复杂，为了解决这个问题，我们使用网关，把所有请求动态路由到对应的终端。网关不仅可以负责动态路由，由于他是请求和响应的出入口，因此它还能做例如权限认证等等。



![1550819913883](/home/hdr/Desktop/Pictures/微服务/SpringCloud/银行系统-微服务-网关.png)

## 服务注册

通过API 网关，我们大大减少了外部调用者的压力。现在有一个问题，当我们微服务越来越多的时候，我们需要编写大量关于网络地址的信息，这就很麻烦了。因此我们需要Service discovery，每个服务启动后，都需要到一个中心地方进行注册，其它服务可以通过这个中心找到它。一般来说就是去注册它的网络地址。

![1550820561173](/home/hdr/Desktop/Pictures/微服务/SpringCloud/银行系统-微服务-服务注册.png)

## 失败与断路器

如果单个服务存在性能问题，我们应尽量减少对其余服务的影响。这时候发送响应超时比长时间等待回复要好。

对于响应超时问题，断路器是其中一个解决方案。断路器负责计数成功和失败的请求，如果错误率超过假定阈值，则它会跳闸并导致所有进一步的尝试立即失败。在特定时间段之后，API客户端应该返回发送请求，这时候如果请求成功，则关闭断路器。

# Spring与微服务

