# JUnit

**基本注解**

```java
@Test    修饰public void 方法，声明一个测试
@Before  修饰public void 方法，运行Test之前执行，运行一个Test，执行一次
@BeforeClass 只执行一次
@After   修饰public void 方法，运行Test之后执行，运行一个Test，执行一次 
@AfterClass  只执行一次
```

**断言**

JUnit框架的Assert类提供了大量的Assert方法。

**处理异常**

```java
@Test(expected=RuntimeException.class)
```

**@RunWith**

该注解需要一个`org.junit.runner.Runner`的实例。

**分组测试**

```java
@RunWith(Suite.class) 
@Suite.SuiteClasses({ 
    FirstTest.class, 
    SecondTest.class
}) 
public class TestSuite {
}

public class RunSuiteTest {
	public static void main(String[] args) {
		Result result = JUnitCore.runClasses(SuiteTest.class);
	}
}
```

**assertThat**

```java
public static void assertThat(Object actual, Matcher matcher);
// Matcher is an implementation of the org.hamcrest.Matcher interface.
// Hamcrest offers a utility matcher class, org.hamcrest.CoreMatchers, with an array of utility matcher methods. 
public class AssertThatTest {
    @Test
    public void test_matcher_behavior() throws Exception {
        int myAge = 30;
		//examine the exact match with equalTo and is
		assertThat(myAge, equalTo(30));
        assertThat(myAge, is(30));
		//examine partial match with not()
		assertThat(myAge, not(equalTo(33)));
        assertThat(myAge, is(not(33)));
    } 
    
    @Test
    public void verify_multiple_values() throws Exception {
        double myMarks = 100.00;
        assertThat(myMarks, either(is(100.00)).or(is(90.9)));
        assertThat(myMarks, both(not(99.99)).and(not(60.00)));
        assertThat(myMarks, anyOf(is(100.00),is(1.00),is(55.00), is(88.00),is(67.8)));
        assertThat(myMarks, not(anyOf(is(0.00),is(200.00))));
        assertThat(myMarks, not(allOf(is(1.00),is(100.00), is(30.00))));} 
} 
```

**自定义matchers**

```java
public class LessThanOrEqual<T extends Comparable<T>> extends BaseMatcher<Comparable<T>> {
   private final Comparable<T> expValue;

   public LessThanOrEqual(T expValue) {
      this.expValue = expValue;
   }

   @Override
   public void describeTo(Description desc) {
      desc.appendText(" less than or equal(<=)" + expValue);
   }

   @Override
   public boolean matches(Object t) {
      int compareTo = expValue.compareTo((T) t);
      return compareTo > -1;
   }
}
```

# Mockito

# Spring Test

Spring提供了一个叫做Test的模块，提供单元测试和整合测试的功能。该框架主要由于两部分组成，`mock`和`test`。

![1553675887805](/home/hdr/Desktop/Java-Notes/工具/images/spring-test.png)

## TestContext框架

`TestContext`框架的核心是两个类和三个接口。

- `TestContext`：提供测试执行的上下文。

- `TestContextManager`：`TestContext`框架的入口，管理一个`TestContext`实例，在执行测试的时候，发布信息给`TestExecutionListener`。

- `TestExecutionListener`：

  - 它具有一些默认实现，这些实现会按照以下顺序进行注册

    • ServletTestExecutionListener: This listener provides the Servlet API 

    mocks for WebApplicationContext 

    • DependencyInjectionTestExecutionListener: As the name suggests, this 

    listener provides dependency injections for the test 

    • DirtiesContextTestExecutionListener: This listener checks the  

    context—whether any bean is dirtied or not during a test execution;  

    it also handles the @DirtiesContext annotation 

    • TransactionalTestExecutionListener: This provides transactional support 

    • SqlScriptsTestExecutionListener: This executes SQL scripts configured 

    via the @Sql annotation 

- `ContextLoader`：加载`ApplicationContext`。

- `SmartContextLoader`：

```java
@ContextConfiguration 
@TestExecutionListeners({
    // 自己实现的一个TestExecutionListener
    SysOutTestExecutionListener.class, 
    // spring提供的TestExecutionListener
	ServletTestExecutionListener.class,
	DependencyInjectionTestExecutionListener.class,
    DirtiesContextTestExecutionListener.class,
    TransactionalTestExecutionListener.class,
    SqlScriptsTestExecutionListener.class 
}) 
@ActiveProfiles(profiles={"dev"}) 
public class TestExecutionListenerTest {} 
// --------------------------------------------------------------------------
@ContextConfiguration 
@TestExecutionListeners(
    // 自己实现的一个TestExecutionListener
    listeners = SysOutTestExecutionListener.class, 
    // 简化上一步
    mergeMode = MERGE_WITH_DEFAULTS 
) 
@ActiveProfiles(profiles={"dev"}) 
public class TestExecutionListenerTest {} 
```

## MockMvc

用来对SpringMVC进行测试。

```java
@RunWith(SpringJUnit4ClassRunner.class) 
@ContextConfiguration(locations ="classpath:beans.xml") 
@WebAppConfiguration 
public class HRControllerTest {
    @Autowiredprivate 
    WebApplicationContext wac;
    private MockMvc mockMvc;
    
    @Before  
    public void setup() {
        this.mockMvc = MockMvcBuilders.webAppContextSetup(this.wac).build();
    }
    
    @Test 
    public void getEmployee() throws Exception {    
        this.mockMvc.perform(
            get("/employees/1")                     
            .accept(MediaType.parseMediaType("application/json;charset=UTF-8")))
            .andExpect(status().isOk())
            .andExpect(content().contentType("application/json;charset=UTF-8"))
            .andExpect(jsonPath("$.name").value("JohnDoe"))
            .andExpect(jsonPath("$.salary").value(100.00))
            .andExpect(jsonPath("$.id").value(1)
        );
    } 
} 
```

## 事务管理测试

```java
@ContextConfiguration({ "classpath:integration.xml" }) @TransactionConfiguration(transactionManager = "transactionManagerBean", defaultRollback = true) 
@Transactional 
@RunWith(SpringJUnit4ClassRunner.class) 
public class PhoneBookDerbySpringDaoIntegrationTest {
    @Autowired
    JdbcTemplate jdbc;
    
    PhoneBookDerbySpringDao dao;
    @Before
    public void init() {
        dao = new PhoneBookDerbySpringDao(jdbc);
    }
    
    @Test
    // .....
```