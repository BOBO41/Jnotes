- JDK 8 或以上
- Gradle 5.0 或以上

# 构建基础Gradle项目

## 初始化项目

```shell
# $_is a special parameter that holds the last argument of the previous command. 
mkdir -p ~/Desktop/gradle/basic-demo && cd "$_"
# Gradle提供了一个叫Build Init的插件，用来生成项目
# 初始化gradle项目
gradle init
# 结果
├── build.gradle # 配置当前项目的Gradle脚本
├── gradle        
│   └── wrapper  # 包装器，
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew      #  
├── gradlew.bat  #
└── settings.gradle # 用来配置Gradle构建的设置脚本
```

## 创建任务

Gradle提供了一些API，用来创建和配置任务(task)，简单来说任务就是用来执行某些操作。

下面我们通过编写一个复制目录的任务来体验一下

```shell
# 前期准备
mkdir src
# 用单引号:原样输出字符串，不进行转义或取变量
echo 'hello world!' > ./src/myFile.txt
# echo "hello world\!" > ./src/myFile.txt
```

```groovy
// 编写任务 build.gradle
task copy(type: Copy, group: "Custom", 
          description: "Copies sources to the dest directory") {
    from "src"
    into "dest"
}
```

```shell
# 运行任务
./gradlew copy
```

再写一个任务

```groovy
// build.gradle
task zip(type: Zip, group: "Archive", description: "Archives sources in a zip file") {
    from "src"
    setArchiveName "basic-demo-1.0.zip"
}
```

```shell
# 运行任务
./gradlew zip
```

## 查看所有任务

```shell
./gradlew tasks
```

```shell
$ basic-demo  ./gradlew tasks

> Task :tasks

------------------------------------------------------------
Tasks runnable from root project
------------------------------------------------------------

Build Setup tasks
-----------------
init - Initializes a new Gradle build.
wrapper - Generates Gradle wrapper files.

Custom tasks
------------
copy - Copies sources to the dest directory

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in root project 'basic-demo'.
components - Displays the components produced by root project 'basic-demo'. [incubating]
dependencies - Displays all dependencies declared in root project 'basic-demo'.
dependencyInsight - Displays the insight into a specific dependency in root project 'basic-demo'.
dependentComponents - Displays the dependent components of components in root project 'basic-demo'. [incubating]
help - Displays a help message.
model - Displays the configuration model of root project 'basic-demo'. [incubating]
projects - Displays the sub-projects of root project 'basic-demo'.
properties - Displays the properties of root project 'basic-demo'.
tasks - Displays the tasks runnable from root project 'basic-demo'.

To see all tasks and more detail, run gradlew tasks --all

To see more detail about a task, run gradlew help --task <task>
```

# Gradle构建Java项目

## 初始化项目

```shell
mkdir javaApp && cd "$_"
gradle init # 选择 java application 、DSL 、 选择测试框架  设置项目名、 设置包名
☁  javaApp  gradle init

Select type of project to generate:
  1: basic
  2: cpp-application
  3: cpp-library
  4: groovy-application
  5: groovy-library
  6: java-application
  7: java-library
  8: kotlin-application
  9: kotlin-library
  10: scala-library
Enter selection (default: basic) [1..10] 6

Select build script DSL:
  1: groovy
  2: kotlin
Enter selection (default: groovy) [1..2] 1

Select test framework:
  1: junit
  2: testng
  3: spock
Enter selection (default: junit) [1..3] 1

Project name (default: javaApp): gradle-java-app
Source package (default: gradle.java.app): com.hdr.app

BUILD SUCCESSFUL in 50s
2 actionable tasks: 2 executed

tree # 查看当前目录结构
☁  javaApp  tree
.
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
├── settings.gradle
└── src
    ├── main
    │   ├── java
    │   │   └── com
    │   │       └── hdr
    │   │           └── app
    │   │               └── App.java
    │   └── resources
    └── test
        ├── java
        │   └── com
        │       └── hdr
        │           └── app
        │               └── AppTest.java
        └── resources
# 查看两个配置文件
cat settings.gradle
cat build.gradle
# 查看Gradle自动生成的代码 
cat ./src/main/java/com/hdr/app/App.java
cat ./src/test/java/com/hdr/app/AppTest.java
```

## 运行项目

```shell
# gradlew 和 gradle的区别
# gradlew是Gradle Wrapper，这东西是在用gradle创建项目的时候生成的，为什么要这个东西？ 因为不同版本的gradle的配置可能有点出入，这个东西在生成的时候就会绑定某个版本的gradle，从而避免上面说所的问题，而且通过使用gradlew，我们甚至无需下载gradle也能执行gradle命名

./gradlew build # 打包
tree # 查看打包后目录结构
./gradlew tasks # 查看有哪些任务可以执行
./gradlew run # 运行该项目
# build/reports/tests/test/index.html  查看测试报告
```

# Gradle构建Java库

## 初始化项目

```shell
mkdir java-lib && cd "$_"
gradle init 
tree # 查看项目目录
cat settings.gradle
cat build.gradle
./gradlew build
```

## 修改META-INF/MANIFEST.MF

官方文档说第一次打包就可以生成可执行的jar文件，但是不知道为什么我的不行，所以添加了额外的配置

```groovy
// 记得先给Libray类添加main方法
jar {
    manifest {
        attributes('Implementation-Title': 'java-lib',
                   'Implementation-Version': '0.1.0',
                   'Main-Class': 'com.hdr.lib.Library'
                  )
    }
}
```

## 重新打包执行

```shell
./gradlew build
java -jar java -jar build/libs/java-lib.jar
```

# 构建JavaWeb项目

## 构建目录

```shell
mkdir java-web && cd "$_"
gradle init #选择普通Java项目
mkdir -p src/main/webapp
```

## 修改配置

```groovy
plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building an application
    id 'application'
	
	// 添加war插件
    id 'war'
    // 容器类插件
    id 'org.gretty' version '2.2.0' 
}
// ...... 省略一些配置
dependencies {
    // This dependency is found on compile classpath of this component and consumers.
    implementation 'com.google.guava:guava:27.0.1-jre'

    // Use JUnit test framework
    testImplementation 'junit:junit:4.12'

    providedCompile 'javax.servlet:javax.servlet-api:3.1.0'
}

```

## 编写Servlet

```java
package com.hdr.web

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet(name = "HelloServlet", urlPatterns = {"hello"}, loadOnStartup = 1) 
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
        response.getWriter().print("Hello, World!");  
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
        String name = request.getParameter("name");
        if (name == null) name = "World";
        request.setAttribute("user", name);
        request.getRequestDispatcher("response.jsp").forward(request, response); 
    }
}
```

```html
<!-- src/main/webapp/index.html -->
<html>
<head>
  <title>Web Demo</title>
</head>
<body>
<p>Say <a href="hello">Hello</a></p> 

<form method="post" action="hello">  
  <h2>Name:</h2>
  <input type="text" id="say-hello-text-input" name="name" />
  <input type="submit" id="say-hello-button" value="Say Hello" />
</form>
</body>
</html>
```

```html
<!-- src/main/webapp/response.jsp -->
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
    <head>
        <title>Hello Page</title>
    </head>
    <body>
        <h2>Hello, ${user}!</h2>
    </body>
</html>
```

```shell
# 运行项目
./gradlew appRun
```



