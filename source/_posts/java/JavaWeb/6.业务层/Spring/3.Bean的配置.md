---
title : 3.Bean的配置
categories : 
- JavaWeb
- Spring
date : 2018-7-11
---

# Bean的配置

## Bean的注册

Spring IoC容器管理一到多个Bean.我们在配置元数据中对Bean进行定义。

```java
@Configuration
public class AppConfig  {
    @Bean
    public Student student(){
        return new Student();
    }
}
```

上面的例子创建了一个Bean，Bean的名字是student。

Spring容器内部使用BeanDefinition对象来代表这些Bean。[BeanDefinition API](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/config/BeanDefinition.html)

Spring容器允许用户在运行期间往容器添加Bean，原理是通过`getBeanFactory`方法获取容器，然后再调用容器的registerXXX方法。

## Bean的命名与描述

```java
@Configuration
public class AppConfig {

    @Bean(name = "myThing")
    public Thing thing() {
        return new Thing();
    }
}

@Configuration
public class AppConfig {

    @Bean(name = { "dataSource", "subsystemA-dataSource", "subsystemB-dataSource" })
    public DataSource dataSource() {
        // instantiate, configure and return DataSource bean...
    }
}

@Configuration
public class AppConfig {

    @Bean
    @Description("Provides a basic example of a bean")
    public Thing thing() {
        return new Thing();
    }
}
```

## Bean的作用域

- singleton   单例
- prototype   原型
- request      请求
- session      会话
- application  应用 
- webSocket

```java
@Bean
@Scope(SCOPE_PROTOTYPE)  // 默认singleton
// ConfigurableBeanFactory.SCOPE_PROTOTYPE, ConfigurableBeanFactory.SCOPE_SINGLETON, WebApplicationContext.SCOPE_REQUEST, WebApplicationContext.SCOPE_SESSION,
public Wheel wheel() {
   return new Wheel();
}
@RequestScope
@SessionScope
@ApplicationScope
```

## Bean的依赖

```java
@Bean
public Wheel wheel() {
	return new Wheel();
}

@Bean
public Car car(Wheel wheel) { // 通过方法参数的方式获取依赖,一般用于从容器中获取依赖
	Car car = new Car();
	car.setWheel(wheel);
	return car;
}	

@Bean
public Car car() {
	Car car = new Car();
    // 通过调用方法的方式获取依赖,一般是调用配置类中的其他创建Bean的方法,而且返回的还是同一个对象。
	car.setWheel(wheel());
	return car;
}
```
### lookup-method



## Bean的生命周期回调

```java
public class Bean {

    public void init() {
        // initialization logic
    }
    
    public void cleanup() {
        // destruction logic
    }
}

@Configuration
public class AppConfig {

    @Bean(initMethod = "init",destroyMethod = "cleanup")
    public Bean bean() {
        return new Bean();
    }

}
```

### @PostConstruct 和 @PreDestroy

在Spring中，你可以通过`InitializingBean` 和 `DisposableBean` 接口或者在配置Bean的时候指定`initMethod`和`destroyMethod`来实现Bean初始化和销毁时调用指定的回调函数。

@PostConstruct 和 @PreDestroy也具有同样的作用

```java
public class CustomerService
{
	String message;
	
	public String getMessage() {
	  return message;
	}

	public void setMessage(String message) {
	  this.message = message;
	}
	
	@PostConstruct
	public void initIt() throws Exception {
	  System.out.println("Init method after properties are set : " + message);
	}
	
	@PreDestroy
	public void cleanUp() throws Exception {
	  System.out.println("Spring Container is destroy! Customer clean up");
	}
	
}
```



### @Lazy

懒加载，在有在需要用到这个Bean的时候，才初始化这个Bean。



