# 基本数据结构

`redis`为我们提供了5种数据结构

- String
- list
- set
- hash
- zset（有序集合）

## String类型的CRUD

`Redis`的字符串是动态字符串，是可以修改的字符串，内部结构实现上类似于 Java 的 `ArrayList`，采用预分配冗余空间的方式来减少内存的频繁分配，当字符串长度小于` 1M `时，扩容都是加倍现有的空间，如果超过 `1M`，扩容时一次只会多扩 `1M`的空间。需要注意的是字符串最大长度为 `512M`。

```bash
# 添加
set key value
setnx key value
# 删除
del key
# 查
exists key
get key
# 批量处理
mset key1 value1 key2 value2
mget key1 key2 
# 过期
expire key second
setex key value second
```

## list

Redis 的列表相当于 Java 语言里面的 LinkedList，注意它是链表而不是数组。这意味着 list 的插入和删除操作非常快，时间复杂度为 O(1)，但是索引定位很慢，时间复杂度为 O(n)，当列表弹出了最后一个元素之后，该数据结构自动被删除，内存被回收。

Redis 的列表结构常用来做异步队列使用。将需要延后处理的任务结构体序列化成字符串塞进 Redis 的列表，另一个线程从这个列表中轮询数据进行处理。

```bash
# 右边进入
rpush books python java golang
# 左边进入  这个有点反人类，一般从从右边进即可
lpush books python java golang
# 右边出
rpop books
# 左边出
lpop books
```

## hash

```bash
hset books java "think in java"
hset books golang "concurrency in go"
hset books python "python cookbook"

hget books golang
hlen books
hgetall books
```

## Set

```bash
sadd books python
smembers books
sismember books java
scard books  # 获取长度相当于 count()
spop books
```

## zset(有序集合)

`zset`它类似于 Java 的 `SortedSet` 和 `HashMap` 的结合体，一方面它是一个 set，保证了内部 value 的唯一性，另一方面它可以给每个 value 赋予一个 score，代表这个 value 的排序权重。

`zset`可以用来存粉丝列表，value 值是粉丝的用户 ID，score 是关注时间。我们可以对粉丝列表按关注时间进行排序。

`zset` 还可以用来存储学生的成绩，value 值是学生的 ID，score 是他的考试成绩。我们可以对成绩按分数进行排序就可以得到他的名次。

```bash
zadd books 9.0 "think in java"
zadd books 8.9 "java concurrency"
zadd books 8.6 "java cookbook"

zrange books 0 -1  # 按 score 排序列出，参数区间为排名范围
zrevrange books 0 -1  # 按 score 逆序列出，参数区间为排名范围

zcard books  # 相当于 count()
# 获取指定 value 的 score score 使用 double 类型进行存储，所以存在小数点精度问题
zscore books "java concurrency" 

zrem books "java concurrency"
```

