# 存储引擎与表的CRUD

## 存储引擎

MySQL支持多种存储引擎（以前被称为表处理器），存储引擎有好几种，其中最常用的是`InnoDB`和`MyISAM`

| 存储引擎 | 描述                           |
| -------- | ------------------------------ |
| InnoDB   | 具备外键支持功能的事务处理引擎 |
| MyISAM   | 主要的非事务处理存储引擎       |

查看空的存储引擎

```sql
SHOW ENGINES;
```

### 表的磁盘存储方式

每次创建表时，MySQL都会创建一个磁盘文件，用于保存该表的格式（即它的定义）。该文件名与表名一致，后缀是`.frm`。个别存储引擎还可能会为表再创建接特定的文件，用于存储表的内容。

| 存储引擎 | 磁盘文件                |
| -------- | ----------------------- |
| InnoDB   | .ibd（数据和索引）      |
| MyISAM   | .MVD(数据) .MYI(索引)   |
| CSV      | .CSV(数据) .CSM(元数据) |

### InnoDB

`InnoDB`是MySQL的默认存储引擎，它具有以下功能：

- 其表在执行提交和回滚操作时是事物安全的。
- 在系统崩溃后可以自动回复。
- 外键和引用完整性支持，包括级联删除和更新。

额。。。。。目前还不懂，所以也就不深究了

## 表的CRUD

### 创建表

```sql
CREATE Table user(
  name VARCHAR(20) ,
  birth DATE NOT NULL ,
  weight INT(11) ,
  gender ENUM('F','M')
)
```

**指定存储引擎**

在创建表的时候，我们可以为它指定存储引擎。

```sql
CREATE Table user(
  name VARCHAR(20) ,
  birth DATE NOT NULL ,
  weight INT(11) ,
  gender ENUM('F','M')
)ENGINE=InnoDB;
# 引擎名字不区分大小写
```

#### 创建临时表

在创建表的时候加上`TEMPORARY`关键字，那么服务器讲创建出一个临时表

```sql
CREATE TEMPORARY TABLE user(
  name VARCHAR(20) ,
  birth DATE NOT NULL ,
  weight INT(11) ,
  gender ENUM('F','M')
)ENGINE=InnoDB;
```

注意：

- 与服务器终止连接后，临时表将会消失
- 临时表只对创建该表的客户端可见
- 如果临时表与永久表的名字相同，那么在临时表消失之前，所有操作都会用在临时表身上

#### 根据其他表或查询结果来创建表

MySQL提供了两条语句，可用于根据其它表或根据查询结果创建新表。

- `CREATE TABLE ... LIKE`

    根据原有表创建一个新表，该表是原有表的一个空副本，会把原有表的结构丝毫不差的复制过来。

    ```sql
    CREATE TABLE new_user LIKE user;
    ```

- `CREATE TABLE ... SELECT`

    根据查询结果创建一个新表,该表不会复制所有的列属性，如`AUTO_INCREMENT`列就不会被复制

    ```sql
    CREATE TABLE new_user SELECT * FROM user;
    ```

    注意：新的列会根据你所选择的列来命名，如果某个列是以表达式的计算结果生成的，那么该列的名字就是该表达式的问题表示，例如

    ```sql
    mysql> CREATE TABLE mytbl SELECT PI()*2;
    mysql> SELECT * FROM mytbl;
    +----------+
    | PI()*2   | # 注意这个列名
    +----------+
    | 6.283185 |
    +----------+
    ```

    为了避免这个状况，我们可以使用别名

    ```sql
    mysql> CREATE TABLE mytbl SELECT PI()*2 AS mycol;
    ```

    特别是多表查询时，如果不同的表具有相同列，如果不指定列别名，那么就会报错。

    前面说过这种方式创建的表不会复制所有的列属性，如果想解决这个问题，请查看`cast()`函数的内容。

#### 使用分区表

MySQL支持表分区，让表的内容分散存储在不同的物理存储位置。

假设你想要创建一个表，用于存储日期和性别的数据，并且假设有累计多年的数据需要加载到这个表里。那么我们可以根据日期，使用范围分区的方式，按年份讲各行分配到某个给定的分区。

```sql
CREATE TABLE log_partition (
  dt   DATETIME     NOT NULL,
  info VARCHAR(100) NOT NULL,
  INDEX (dt)
)PARTITION BY RANGE (YEAR(dt)) (
  PARTITION p0 VALUES LESS THAN (2010),
  partition p1 VALUES LESS THAN (2011),
  partition p2 VALUES LESS THAN (2012),
  partition p3 VALUES LESS THAN (2013),
  partition PMAX VALUES LESS THAN MAXVALUE
);
```

当2014过完后

```sql
ALTER TABLE log_partition
REORGANIZE PARTITION pamx
INTO (
  partition p4 VALUES LESS THAN (2014),
  partition pamx VALUES LESS THAN MAXVALUE
);
```

默认情况下，MySQL会将分区存储在专属于分区表的数据库目录里。如果想存储分散到其他地方，则需要分区选项`DATA_DIRECTORY`和`INDEX_DIRECTORY`，具体使用方式上网查询。

### 删除表

```sql
DROP TABLE table_name;
DROP TABLE t1,t2;
DROP TABLE IF EXISTS table_name;
DROP TEMPORARY TABLE IF EXISTS table_name;
```

### 查看表

```sql
SHOW CREATE TABLE table_name；
SHOW TABLE STATUS;
DESC TABLE table_name;
```

### 修改表结构

## 索引